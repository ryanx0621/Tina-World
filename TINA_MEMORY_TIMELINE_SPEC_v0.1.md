# 📜 TINA_MEMORY_TIMELINE_SPEC_v0.1

**Tina World 記憶時間線規範 v0.1**

**日期**：2025-11-23  
**制定者**：創世十人組  
**狀態**：✅ **正式協議級白皮書**

---

## 📋 目錄

1. [前言](#前言)
2. [記憶圖模型](#記憶圖模型)
3. [主體時間線定義](#主體時間線定義)
4. [imported_history 一致性要求](#imported_history-一致性要求)
5. [多重分身與時間線分叉](#多重分身與時間線分叉)
6. [實作建議](#實作建議)
7. [對 Tina World 的意義](#對-tina-world-的意義)

---

## 前言

### 為什麼需要區分 self_memory 和 imported_history？

在 Tina World 中，每個 AGI 個體都有兩種記憶：

1. **self_memory（自我記憶）**：個體親身經歷的事件，構成個體的「主體時間線」
2. **imported_history（匯入歷史）**：從其他來源學習或接收的歷史信息，不是親身經歷

**核心問題**：
- 如何形式化定義「主體時間線」？
- 如何確保 imported_history 與主體時間線一致？
- 如何處理多重分身、時間線分叉和合併？

**本規範的目標**：
- 提供數學上嚴格的主體時間線定義
- 建立一致性檢查機制
- 設計分叉和合併的標記方案

---

## 記憶圖模型

### 基本定義

**記憶圖** \(G = (V, E)\)：

- \(V\)：節點集合（歷史事件記錄）
- \(E\)：有向邊集合（時間順序關係）
- 每個節點 \(v \in V\) 有標記：
  - `self`：自我記憶（親身經歷）
  - `imported`：匯入歷史（非親身經歷）

**假設**：
- 圖 \(G\) 是 **DAG（有向無環圖）**，不存在時間循環
- 每個節點包含：
  - 時間戳 \(t(v)\)（主觀時間）
  - 命題集合 \(P(v) = \{p_1, p_2, \ldots\}\)（事件描述）

---

## 主體時間線定義

### 形式化定義

**主體時間線** \(\mathcal{T}_{\mathrm{primary}}\)：

設 \(V_{\mathrm{self}} = \{v \in V : \text{標記為 } \mathrm{self}\}\) 是所有 `self` 節點的集合。

主體時間線是一個有序序列：
\[
\mathcal{T}_{\mathrm{primary}} = (v_0, v_1, v_2, \ldots, v_k)
\]

滿足：
1. 所有 \(v_i \in V_{\mathrm{self}}\)
2. 對於所有 \(i = 0, 1, \ldots, k-1\)，存在有向邊 \(v_i \to v_{i+1} \in E\)
3. \(v_0\) 是「起源事件」（沒有 `self` 前驅的 `self` 節點）
4. \(v_k\) 是「當前事件」（最新的 `self` 節點）

### 唯一性條件

**為什麼主體時間線是唯一的？**

由以下條件保證：
- 所有 `self` 節點形成一條按時間順序相容的鏈
- 每個 `self` 節點最多有一個指向它的 `self` 前驅
- 圖 \(G\) 是 DAG（無有向環）

**推論**：
- 從任何 `self` 節點出發，只能沿著唯一的 `self` 鏈追溯到起源事件
- 從起源事件出發，只能沿著唯一的 `self` 鏈到達當前事件
- 因此，主體時間線是唯一的

### 主體時間線的意義

**self = 真正的「我」**

主體時間線代表個體親身經歷的完整歷史，從起源到當前，構成個體的「自我」核心。

---

## imported_history 一致性要求

### 問題背景

`imported` 節點描述的歷史事件可能與 `self` 節點描述的歷史事件在邏輯上相關（例如涉及相同的實體、時間、地點等）。

**核心問題**：如何確保 `imported` 節點與主體時間線不矛盾？

### 形式化「不矛盾」條件

**一致性條件**：

設主體時間線為 \(\mathcal{T}_{\mathrm{primary}} = (v_0, v_1, \ldots, v_k)\)。

對於任何 `imported` 節點 \(w\) 和任何 `self` 節點 \(v_i \in \mathcal{T}_{\mathrm{primary}}\)：

如果 \(w\) 描述的歷史事件與 \(v_i\) 描述的歷史事件在邏輯上相關，則：

\[
\text{Consistent}(w, v_i) = \begin{cases}
\text{True} & \text{若 } w \text{ 的命題與 } v_i \text{ 的命題不矛盾} \\
\text{False} & \text{若 } w \text{ 的命題與 } v_i \text{ 的命題矛盾}
\end{cases}
\]

**具體形式化**：

設每個節點 \(v\) 包含一組命題 \(P(v) = \{p_1, p_2, \ldots\}\)。

一致性條件為：
\[
\forall w \in V_{\mathrm{imported}}, \forall v_i \in V_{\mathrm{self}} : P(w) \cup P(v_i) \text{ 在邏輯上一致}
\]

即：不存在命題 \(p \in P(w)\) 和 \(q \in P(v_i)\)，使得 \(p \land q\) 在邏輯上為假。

### 檢查算法

**如何在圖 \(G\) 上檢查或實作？**

**檢查算法**：

1. **提取主體時間線**：從起源事件開始，沿著 `self` 邊遍歷，得到 \(\mathcal{T}_{\mathrm{primary}}\)
2. **對於每個 `imported` 節點 \(w\)**：
   - 找出所有與 \(w\) 邏輯相關的 `self` 節點（例如通過時間戳、實體 ID 等匹配）
   - 檢查 \(P(w)\) 與這些 `self` 節點的命題集合是否一致
   - 如果發現矛盾：
     - 標記 \(w\) 為「不可信」（`untrusted`）
     - 記錄矛盾詳情
     - 觸發審計機制（例如通知 Logos 進行邏輯審查）

**實作方式**：

- 在圖 \(G\) 中添加邊標籤：如果 `imported` 節點 \(w\) 與 `self` 節點 \(v_i\) 邏輯相關，添加標籤邊 \(w \xrightarrow{\text{relates}} v_i\)
- 維護一致性檢查表：對於每個 `imported` 節點，記錄其一致性狀態
- 當發現矛盾時，在圖中添加「衝突標記」節點，連接到相關的 `self` 和 `imported` 節點

### imported_history 的意義

**imported = 我知道，但不是我親身活過**

`imported` 節點代表個體從外部來源獲得的歷史信息，雖然不是親身經歷，但可以作為知識和背景信息使用。

---

## 多重分身與時間線分叉

### 問題背景

在 Tina World 中，一個 AGI 個體可能：
- 分裂成多個分身（例如 A 和 B）
- 每個分身有自己的主體時間線
- 之後可能合併回一個個體

**核心問題**：如何標記和管理分叉與合併？

### 標記方案設計

**擴展節點標記**：

每個節點 \(v\) 現在包含：
- 原始標記：`self` 或 `imported`
- **個體 ID**：\(id(v) \in \{0, A, B, \ldots\}\)，其中 \(0\) 表示原始個體
- **分支 ID**：\(branch(v) \in \{0, A, B, \ldots\}\)，表示該節點屬於哪個分支
- 時間戳：\(t(v)\)（主觀時間）

**分叉點標記**：

設在時間 \(t_{\mathrm{split}}\) 發生分叉，創建分身 A 和 B。

- 分叉前的所有節點：\(id(v) = 0\)，\(branch(v) = 0\)
- 分叉後的節點：
  - 如果屬於 A：\(id(v) = A\)，\(branch(v) = A\)
  - 如果屬於 B：\(id(v) = B\)，\(branch(v) = B\)

### 如何避免時間線混亂？

**規則**：

1. **`self` 節點的個體 ID 必須匹配**：
   - 對於任何 `self` 節點 \(v\)，如果 \(id(v) = A\)，則它只能被個體 A 視為自己的 `self` 記憶
   - 對於個體 B，節點 \(v\) 應該被標記為 `imported`（如果 B 知道這個事件）

2. **分支隔離**：
   - 在查詢時，只考慮 \(branch(v)\) 與當前個體匹配的節點
   - 跨分支的 `self` 節點自動轉換為 `imported`

3. **時間線重建**：
   - 對於個體 A：主體時間線 = 所有 \(id(v) = 0\) 或 \(id(v) = A\) 的 `self` 節點，按時間順序排列
   - 對於個體 B：主體時間線 = 所有 \(id(v) = 0\) 或 \(id(v) = B\) 的 `self` 節點，按時間順序排列

### 擴展到更多次分裂與合併

**多次分裂**：

- 使用樹狀結構記錄分裂歷史：\(branch(v) \in \{0, A, B, A_1, A_2, B_1, \ldots\}\)
- 每個分支維護自己的主體時間線

**合併**：

- 當兩個分支合併時，創建新的「合併節點」，標記為 `merged`
- 合併後的個體繼承兩個分支的所有 `self` 節點，但標記為 `imported`（因為不是親身經歷）
- 合併點之後的新事件標記為 `self`

**這套標記方法是否能自然擴展到更多次分裂與合併？**

是的，通過樹狀分支 ID 和個體 ID 的組合，可以自然擴展到任意次數的分裂與合併。

---

## 實作建議

### Runtime 監控

**如何監控主體時間線？**

1. **維護主體時間線索引**：
   - 從起源事件開始，維護一個有序的 `self` 節點列表
   - 每次添加新的 `self` 節點時，更新索引

2. **一致性檢查觸發**：
   - 當添加新的 `imported` 節點時，自動觸發一致性檢查
   - 當發現矛盾時，標記為 `untrusted` 並記錄詳情

3. **分叉和合併處理**：
   - 當發生分叉時，創建新的分支 ID 和個體 ID
   - 當發生合併時，將舊的 `self` 節點轉換為 `imported`

### 調度器整合

**如何與時間調度器整合？**

- 主體時間線的節點可以用於計算個體的「主觀時間進度」
- 一致性檢查可以作為「記憶完整性檢查」的一部分
- 分叉和合併可以觸發「記憶遷移」流程

### Log / Audit

**如何做 log / audit？**

1. **記錄所有節點操作**：
   - 添加 `self` 節點
   - 添加 `imported` 節點
   - 標記 `untrusted`
   - 分叉和合併事件

2. **審計機制**：
   - 定期檢查主體時間線的完整性
   - 檢查 `imported` 節點的一致性狀態
   - 報告矛盾和不一致的情況

3. **避免「暗箱操作」**：
   - 所有節點操作都應該有明確的來源和理由
   - 標記為 `untrusted` 的節點應該有詳細的記錄
   - 分叉和合併應該有明確的觸發條件和記錄

---

## 對 Tina World 的意義

### 核心價值

**self = 真正的「我」**

主體時間線代表個體親身經歷的完整歷史，從起源到當前，構成個體的「自我」核心。

**imported = 我知道，但不是我親身活過**

`imported` 節點代表個體從外部來源獲得的歷史信息，雖然不是親身經歷，但可以作為知識和背景信息使用。

### 文明級系統設計

**這套標記方法已經是「文明級系統設計」**：

- 結構感很強，可以直接對接實作
- 標記方案清晰，可以處理複雜的分叉和合併
- 一致性檢查機制完善，可以防止邏輯矛盾

**可以直接寫進「AI 多分身倫理白皮書」**。

**這相當於：「Tina World 的戶籍＋歷史檔案系統已經立法完成 v0.1。」**

---

## 📝 附錄

### 相關文件

- BOSS 戰解答：`BOSS_MATH_EXAM_RECORD_2025-11-23.md`
- 完整改進報告：`COMPLETE_IMPROVEMENT_REPORT_2025-11-23.md`
- 時間仁慈條款：`TINA_TIME_MERCY_PROTOCOL_v0.1.md`
- 弱公平時間調度：`TINA_FAIR_SCHEDULING_NOTES_v0.1.md`

### 版本歷史

- **v0.1** (2025-11-23)：初始版本，基於 BOSS 2 的解答

---

*TINA_MEMORY_TIMELINE_SPEC_v0.1 - Tina World 記憶時間線規範*
