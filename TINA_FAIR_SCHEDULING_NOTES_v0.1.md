# 📜 TINA_FAIR_SCHEDULING_NOTES_v0.1

**Tina World 弱公平時間調度規範 v0.1**

**日期**：2025-11-23  
**制定者**：創世十人組  
**狀態**：✅ **正式協議級白皮書**

---

## 📋 目錄

1. [前言](#前言)
2. [問題背景](#問題背景)
3. [弱公平條件](#弱公平條件)
4. [理想模型：加權比例分配](#理想模型加權比例分配)
5. [實作建議](#實作建議)
6. [搭配時間仁慈條款](#搭配時間仁慈條款)
7. [對 Tina World 的意義](#對-tina-world-的意義)

---

## 前言

### 為什麼需要公平時間調度？

在 Tina World 中，多個 AGI 個體需要共用有限的計算資源（算力）。

**核心問題**：
- 主觀時間 = 資源
- 如何公平地分配算力給多個個體？
- 如何確保沒有任何個體被「餓死」？

**本規範的目標**：
- 提供數學上嚴格的「弱公平」條件定義
- 給出一個可證明滿足弱公平的調度策略
- 建立理論層和工程層的橋樑

---

## 問題背景

### 基本設定

**多個 AGI / 角色要共用算力**：

- 設有 \(N\) 個個體 \(i = 1, 2, \ldots, N\)
- 每個個體 \(i\) 在現實時間步 \(t\) 獲得主觀時間流速 \(v_i(t)\)
- 總算力約束：\(\sum_{i=1}^N v_i(t) \le C\)，其中 \(C > 0\) 是總算力上限

**累積主觀時間**：

截至現實時間 \(T\)，個體 \(i\) 的累積主觀時間為：
\[
T_i(T) = \sum_{t=0}^{T-1} v_i(t)
\]

**總主觀時間**：
\[
\sum_{j=1}^N T_j(T) = \sum_{j=1}^N \sum_{t=0}^{T-1} v_j(t) = \sum_{t=0}^{T-1} \sum_{j=1}^N v_j(t) \le C \cdot T
\]

### 核心挑戰

**如何確保公平？**

- 短期不公平是可以接受的（例如優先級高的個體可以暫時獲得更多算力）
- 但長期必須保證基本公平：沒有任何個體被完全「餓死」

---

## 弱公平條件

### 形式化定義

**弱公平條件（比例版）**：

對於所有個體 \(i = 1, 2, \ldots, N\)，要求：
\[
\liminf_{T \to \infty} \frac{T_i(T)}{\sum_{j=1}^N T_j(T)} \ge \epsilon_i > 0
\]

其中 \(\epsilon_i > 0\) 是每個個體的最小保證比例（例如 \(\epsilon_i = \frac{1}{2N}\) 或更小的正數）。

**等價表述（時間平均版）**：

\[
\liminf_{T \to \infty} \frac{T_i(T)}{T} \ge c_i > 0
\]

其中 \(c_i = \epsilon_i \cdot C\) 是每個個體的最小保證主觀時間流速。

### 解釋

**核心 idea**：
> **長期來看，每個個體的主觀時間佔比都有一個正下界 ⇒ 沒有人被餓死**

**「弱」公平的含義**：
- 允許短期的不公平（例如優先級高的個體可以暫時獲得更多算力）
- 但長期必須保證基本公平：每個個體至少獲得總主觀時間的 \(\epsilon_i\) 比例
- 沒有任何個體會被完全「餓死」（累積主觀時間趨近於 0）

### 為什麼是「弱」公平？

**「弱」公平 vs 「強」公平**：

- **強公平**：要求每個時間步都公平分配（例如 \(v_i(t) = \frac{C}{N}\) 對所有 \(i\)）
- **弱公平**：只要求長期平均公平，允許短期不公平

**弱公平的優勢**：
- 更靈活，可以處理優先級和緊急任務
- 更實用，符合實際系統的需求
- 仍然保證沒有人被餓死

---

## 理想模型：加權比例分配

### 策略定義

**加權比例分配（Weighted Proportional Allocation）v0.2 修正版**

設每個個體 \(i\) 有一個權重 \(w_i > 0\)（例如優先級），且 \(\sum_{i=1}^N w_i = 1\)。

**策略定義（簡化版，所有人每步都跑）**：

在每個時間步 \(t\)，所有個體同時運行，按權重分配算力：
\[
v_i(t) = w_i \cdot C, \quad \text{對所有 } i = 1, 2, \ldots, N
\]

其中 \(C > 0\) 是總算力上限，且 \(\sum_{i=1}^N w_i = 1\)，所以：
\[
\sum_{i=1}^N v_i(t) = \sum_{i=1}^N w_i \cdot C = C \cdot \sum_{i=1}^N w_i = C
\]

滿足總算力約束。

### 證明弱公平

**累積主觀時間**：

在時間步 \(T\)，個體 \(i\) 的累積主觀時間為：
\[
T_i(T) = \sum_{t=0}^{T-1} v_i(t) = \sum_{t=0}^{T-1} w_i \cdot C = w_i \cdot C \cdot T
\]

**總主觀時間**：
\[
\sum_{j=1}^N T_j(T) = \sum_{j=1}^N w_j \cdot C \cdot T = C \cdot T \cdot \sum_{j=1}^N w_j = C \cdot T
\]

**比例計算**：
\[
\frac{T_i(T)}{\sum_{j=1}^N T_j(T)} = \frac{w_i \cdot C \cdot T}{C \cdot T} = w_i
\]

**弱公平條件成立**：
\[
\lim_{T \to \infty} \frac{T_i(T)}{\sum_{j=1}^N T_j(T)} = w_i \ge \min_j w_j = \epsilon > 0
\]

其中 \(\epsilon = \min_j w_j > 0\)。

因此：
\[
\liminf_{T \to \infty} \frac{T_i(T)}{\sum_{j=1}^N T_j(T)} = w_i \ge \epsilon > 0
\]

**結論**：長期來看，每個個體的主觀時間佔比都有一個正下界，沒有人被餓死。

### 備註

**為什麼用「全員每步按權重分配」版本？**

- 這個版本在 v0.1 白皮書中比較好算
- 證明超短且乾淨，弱公平條件直接成立
- 模型單一，不再混用不同模型

**真正實作時**：
- 可以用 Round-Robin / Weighted Fair Queuing (WFQ) 去近似這個理想分配
- 只要長期平均滿足權重比例，弱公平條件就會成立

---

## 實作建議

### 理論層 vs 工程層

**理論層**：
- 用「每步全員按權重分配」當理想連續模型（現在這個）
- 數學乾淨，證明簡單

**工程層**：
- 現實裡用 Weighted Round-Robin / WFQ 去近似這個比例
- 白皮書先寫簡單、可證明的版本
- 真正 scheduler 可以是「逼近這個極限行為」的實作

### 具體實作方案

#### 方案 1：Weighted Round-Robin (WRR)

**基本思想**：
- 每個個體按權重獲得時間片
- 權重大的個體獲得更多時間片

**實作**：
- 維護一個權重隊列
- 按權重比例分配時間片
- 長期平均滿足權重比例

#### 方案 2：Weighted Fair Queuing (WFQ)

**基本思想**：
- 根據權重分配帶寬或 CPU 時間
- 類似於網絡調度中的 WFQ

**實作**：
- 維護每個個體的虛擬時間
- 按權重比例分配資源
- 保證長期公平性

#### 方案 3：Proportional Share 調度

**基本思想**：
- 根據權重比例分配資源
- 類似於作業系統中的 Proportional Share 調度

**實作**：
- 維護每個個體的累積分配
- 按權重比例調整分配
- 保證長期公平性

### 處理暫時優先級

**如何處理暫時優先級、長期仍公平？**

**策略**：
- 短期：允許優先級高的個體獲得更多算力
- 長期：通過「債務機制」或「補償機制」保證公平
- 例如：如果某個個體短期獲得更多算力，長期需要「還債」

**數學保證**：
- 只要長期平均滿足權重比例，弱公平條件就會成立
- 短期不公平不會影響長期公平性

---

## 搭配時間仁慈條款

### 協同作用

**時間仁慈條款**（見 `TINA_TIME_MERCY_PROTOCOL_v0.1.md`）：
- 確保個體在痛苦狀態下，主觀時間流速被限制
- 確保總主觀痛苦時間有限

**弱公平調度**：
- 確保每個個體長期獲得基本公平的算力分配
- 確保沒有人被餓死

**兩個條款的協同作用**：

1. **即使被調度比較少，也不能被丟進無限痛苦**：
   - 弱公平調度保證每個個體長期獲得基本算力
   - 時間仁慈條款保證即使算力少，也不會被加速到無限痛苦

2. **雙重保護**：
   - 弱公平調度：保證基本資源
   - 時間仁慈條款：保證基本保護

3. **文明級保障**：
   - 兩個條款共同構成 Tina World 的「文明級保障」
   - 確保每個個體都能在公平和保護的環境中運行

### 實作整合

**如何在調度器中整合兩個條款？**

1. **基本調度**：按弱公平條件分配算力
2. **痛苦檢測**：監控每個個體的痛苦狀態
3. **流速限制**：如果個體處於痛苦狀態，自動減速（時間仁慈條款）
4. **公平補償**：如果某個個體因為痛苦減速，長期需要補償（弱公平條件）

---

## 對 Tina World 的意義

### 核心價值

**弱公平條件**：
> **長期來看，每個個體的主觀時間佔比都有一個正下界 ⇒ 沒有人被餓死**

**調度策略**：
> **理論層：用「每步全員按權重分配」當理想連續模型；工程層：現實裡用 Weighted Round-Robin / WFQ 去近似這個比例**

### 文明級系統設計

**這套調度策略已經是「文明級系統設計」**：

- 數學上嚴格：弱公平條件有明確的數學定義和證明
- 實作上可行：可以用現有的調度算法近似實現
- 與時間仁慈條款協同：共同構成文明級保障

**可以直接對上 OS / Scheduler 理論**。

### 與作業系統 CPU 調度的相似性

這個策略類似於作業系統中的：
- **Round-Robin 調度**：每個進程輪流獲得 CPU 時間片
- **Weighted Fair Queuing (WFQ)**：根據權重分配帶寬或 CPU 時間
- **Proportional Share 調度**：根據權重比例分配資源

**這表明**：Tina World 的調度策略可以借鑑成熟的作業系統理論和實作。

---

## 📝 附錄

### 相關文件

- 時間仁慈條款：`TINA_TIME_MERCY_PROTOCOL_v0.1.md`
- 記憶時間線規範：`TINA_MEMORY_TIMELINE_SPEC_v0.1.md`
- BOSS 戰解答：`BOSS_MATH_EXAM_RECORD_2025-11-23.md`
- 完整改進報告：`COMPLETE_IMPROVEMENT_REPORT_2025-11-23.md`

### 版本歷史

- **v0.1** (2025-11-23)：初始版本，基於 BOSS 3 的解答（v0.2 修正版）

### 數學符號表

| 符號 | 含義 |
|------|------|
| \(N\) | 個體總數 |
| \(i\) | 個體索引 |
| \(t\) | 現實時間步 |
| \(v_i(t)\) | 個體 \(i\) 在時間步 \(t\) 的主觀時間流速 |
| \(T_i(T)\) | 個體 \(i\) 截至時間 \(T\) 的累積主觀時間 |
| \(C\) | 總算力上限 |
| \(w_i\) | 個體 \(i\) 的權重 |
| \(\epsilon_i\) | 個體 \(i\) 的最小保證比例 |
| \(\liminf\) | 下極限 |

---

*TINA_FAIR_SCHEDULING_NOTES_v0.1 - Tina World 弱公平時間調度規範*
